# Техническое задание

### Создание базы данных

Ранее вы использовали PostgreSQL — популярную в индустрии базу данных. Однако сейчас вы будете работать с
другой базой. Она называется **H2**. H2 не требует отдельной установки. Её можно встроить в приложение — достаточно
добавить
зависимость в сборку проекта. Использование встроенной базы данных упростит тестирование вашего приложения в GitHub.

База будет работать в двух режимах:

- В режиме тестирования H2 будет хранить данные в памяти. Это позволит базе быстро запуститься на время тестов и удалить
  все тестовые данные после их завершения.
- В рабочем режиме H2 будет хранить данные в файле на жёстком диске. Это не позволит рабочим данным потеряться между
  запусками.

Почитайте, как использовать H2 со Spring Boot, [в этой статье](https://www.baeldung.com/spring-boot-h2-database). Далее
следуйте нашей инструкции:

1. Добавьте в проект зависимости `com.h2database.h2`, `org.springframework.boot.spring-boot-starter-jdbc` и
   `org.springframework.boot.spring-boot-starter-test`.
2. Сконфигурируйте базу данных для рабочего режима с помощью файла настроек `application.properties`.

```
spring.sql.init.mode=always
# в jdbc-url укажите, что данные нужно сохранять в файл
spring.datasource.url=jdbc:h2:file:./db/filmorate
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=password
```

3. Сформируйте структуру базы данных. Обратите
   внимание: база будет работать, пока работает само приложение. Чтобы подключиться к БД напрямую, используйте
   встроенный в IntelliJ IDEA функционал или клиент DBeaver.

### Про файл schema.sql

Включите в файл `schema.sql` создание таблиц. Если вам нужны некоторые данные в базе, их инициализация обычно
описывается
в файле `data.sql` — создайте его там же, где и `schema.sql`.
Чтобы избежать ошибок, связанных с многократным применением скрипта к БД, добавьте условие `IF NOT EXISTS` при создании
таблиц и индексов.

### Работа с DAO

После того как создадите базу можно заняться кодом, который будет отвечать за получение данных из базы.

1. Вам пригодятся созданные ранее интерфейсы `UserStorage` и `FilmStorage`. Напишите для них новую имплементацию —
   например,
   `UserDbStorage` и `FilmDbStorage`. Эти классы будут DAO — объектами доступа к данным.
2. Напишите в DAO соответствующие мапперы и методы, позволяющие сохранять пользователей и фильмы в базу данных и
   получать их из неё.

<details>
<summary>Подсказка: про аннотацию @Qualifier</summary>

Чтобы Spring мог работать с новыми компонентами и отличать их от старых хранилищ, воспользуйтесь
аннотацией `@Qualifier`.
Пример её использования можно найти [в этой статье](https://www.baeldung.com/spring-qualifier-annotation).
</details>

<details>
<summary>Подсказка: как проверить, что база данных успешно настроена</summary>

Убедитесь, что ваше приложение работает с базой данных. Создайте новый фильм и пользователя, а потом перезапустите
проект — данные должны сохраниться в базе и быть доступны после перезапуска.
</details>

<details>
<summary>Подсказка: как реализовать CRUD-операции с использованием JdbcTemplate</summary>

В теме о работе с БД вы узнали, как делать выборку данных из базы с помощью SQL-запросов и `JdbcTemplate`. Для
реализации
методов, описанных в интерфейсах хранилищ, вам также потребуется добавлять новые данные и обновлять имеющиеся.
Почитайте, как это сделать, [в этой статье](https://springframework.guru/spring-jdbctemplate-crud-operations/).
</details>

### Доработка бизнес-логики

Осталось несколько штрихов. Добавьте в код недостающие DAO-объекты, соответствующие вашей схеме, и завершите описание
бизнес-логики. После этого протестируйте поведение программы.

Поскольку в программе появились новые сущности, то нужно обеспечить доступ к ним. Добавьте следующие эндпоинты:

1. Для получения списка всех жанров и по идентификатору.

```
GET /genres 
GET /genres/{id}

// Пример возвращаемого значения
{
    "id": 1,
    "name": "Комедия"
}
```

2. Для получения жанра и рейтинга по идентификатору:

```
GET /mpa
GET /mpa/{id}

// Пример возвращаемого значения
{
    "id": 1,
    "name": "G"
}
```

При создании и получении фильмов достаточно передать список идентификаторов жанров и идентификатор рейтинга. Эти же
данные должны передаваться при обновлении, создании и получении фильмов — если нужно, обновите эти эндпоинты.

И последнее небольше изменение: дружба должна стать односторонней. Это значит, что если какой-то пользователь оставил
вам заявку в друзья, то он будет в списке ваших друзей, а вы в его — нет.

Не забудьте: у пользователей `Filmorate` должна быть возможность лайкать фильмы и добавлять друг друга в друзья с
подтверждением дружбы.

Убедитесь, что ваше приложение работает правильно. Проверьте его дополнительно с помощью тестов Postman: [postman.json](postman.json).

